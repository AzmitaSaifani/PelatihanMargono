<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Home - DIKLAT RSMS</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicons -->
    <link
      rel="icon"
      href="/pelatihanmargono/backend/uploads/foto/LogoRSMS2.png"
      type="image/png"
      sizes="512x512"
    />
    <link
      rel="apple-touch-icon"
      href="/pelatihanmargono/backend/uploads/foto/LogoRSMS.png"
      sizes="180x180"
    />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="assets/vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/swiper/swiper-bundle.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />

    <!-- Main CSS File -->
    <link href="./assets/css/main.css" rel="stylesheet" />

    <!-- FullCalendar JS GLOBAL BUILD -->
    <script src="https://unpkg.com/fullcalendar@6.1.8/index.global.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  </head>

  <body class="index-page">
    <!-- ================= HEADER ================= -->
    <header id="header" class="header d-flex align-items-center fixed-top">
      <div
        class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between"
      >
        <a
          href="index.html"
          class="logo d-flex align-items-center me-auto me-xl-0"
        >
          <img
            src="/pelatihanmargono/backend/uploads/foto/LogoRSMS.png"
            alt="Logo RSMS"
            style="height: 40px; margin-right: 8px"
          />

          <h1 class="sitename">DIKLAT RSMS</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html" class="active">Home</a></li>

            <li class="dropdown">
              <a href="#">
                <span>Pelatihan</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i>
              </a>
              <ul>
                <li><a href="menupelatihan.html">Menu Pelatihan</a></li>
                <li><a href="kalender.html">Kalender Pelatihan</a></li>
                <li><a href="daftarpelatihan.html">Daftar Pelatihan</a></li>
                <li><a href="alurpendaftaran.html">Alur Pendaftaran</a></li>
                <li><a href="gallery.html">Gallery</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#">
                <span>Tim & Mitra Pelatihan</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i>
              </a>
              <ul>
                <li>
                  <a href="fasilitator.html">
                    Profesional Fasilitor dan Instuktur Tersertifikasi
                  </a>
                </li>
                <li>
                  <a href="penyelenggara.html">
                    Tim Penyelenggara Pelatihan Tersertifikasi
                  </a>
                </li>
                <li><a href="intitusi.html">Institusi Kerjasama</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#">
                <span>About</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i>
              </a>
              <ul>
                <li><a href="profil.html">Profil Diklat</a></li>
                <li>
                  <a href="struktur_organisasi.html">Struktur Organisasi</a>
                </li>
                <li><a href="contact.html">Kontak</a></li>
              </ul>
            </li>

            <li><a href="kritiksaran.html">Kritik Saran</a></li>

            <li class="ms-lg-3">
              <a href="daftarpelatihan.html" class="btn btn-accent nav-cta">
                Daftar Pelatihan
              </a>
            </li>
          </ul>

          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>
      </div>
    </header>

    <main class="main">

      <!-- Hero Section -->
      <section id="hero" class="hero section dark-background">
        <div class="hero-wrapper">
          <div class="hero-image">
            <img
              src="/pelatihanmargono/backend/uploads/foto/rs margono.jpg"
              alt="RSMS"
              class="img-fluid"
            />
          </div>

          <div class="hero-content">
            <div class="container">
              <div class="row">
                <div
                  class="col-lg-8 col-md-10"
                  data-aos="fade-right"
                  data-aos-delay="100"
                >
                  <div class="content-box">
                    <h3 data-aos="fade-up" data-aos-delay="250">
                      Halo, Selamat Datang di
                    </h3>

                    <h1 data-aos="fade-up" data-aos-delay="200">
                      DIKLAT <br />
                      RSUD Prof. Dr. MARGONO SOEKARJO<br />
                      Purwokerto
                    </h1>

                    <div
                      class="cta-group"
                      data-aos="fade-up"
                      data-aos-delay="300"
                    >
                      <a href="daftarpelatihan.html" class="btn btn-primary">
                        Daftar Pelatihan
                      </a>

                      <a href="menupelatihan.html" class="btn btn-outline">
                        Menu Pelatihan
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Home About Section -->
      <section id="home-about" class="home-about section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
          <div class="row gy-5 align-items-center">
            <div
              class="col-lg-12"
              data-aos="fade-left"
              data-aos-delay="300"
            >
              <div class="container section-title" data-aos="fade-up">
                <h2 style="text-align: center; margin-top:30px;">PROFIL DIKLAT</h2>
              </div>

                <!-- BAGIAN ATAS -->
                <div class="row g-4">
                  <div class="col-md-6" data-aos="fade-up">
                    <div class="feature-item">
                      <h4 id="profilRingkasAtas">Memuat...</h4>
                    </div>
                  </div>

                  <div
                    class="col-md-6"
                    data-aos="fade-up"
                    data-aos-delay="150"
                  >
                    <div class="feature-item">
                      <h4 id="profilSK">Memuat...</h4>
                    </div>
                  </div>
                </div>

                <!-- FOTO & DESKRIPSI -->
                <div class="row g-4 mt-4">
                  <!-- FOTO -->
                  <div class="col-lg-6" data-aos="fade-right">
                    <div class="about-image">
                      <img
                        src="/pelatihanmargono/backend/uploads/foto/PELATIHAN ACLS.jpeg"
                        alt="RSMS"
                        class="img-fluid rounded-3 mb-4"
                      />
                    </div>
                  </div>

                  <!-- DESKRIPSI DINAMIS -->
                  <div class="col-lg-6" data-aos="fade-left">
                    <div id="profilDiklatContent"></div>

                    <!-- CTA -->
                    <div class="cta-wrapper mt-4">
                      <a href="profil.html" class="btn btn-primary">
                        Profil Selengkapnya
                      </a>
                      <a href="profil.html#tim-diklat" class="btn btn-outline">
                        Tim Diklat
                      </a>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </section>
      <!-- /Home About Section -->

      <script>
        document.addEventListener("DOMContentLoaded", async () => {
          try {
            /* =========================
              LOAD PROFIL DIKLAT (AGGREGATOR)
              ========================= */
            const res = await fetch("http://localhost:5000/api/profil-diklat");
            const data = await res.json();

            const { institusi, histori, sertifikat, timKerja } = data;

            if (!institusi) {
              throw new Error("Data institusi kosong");
            }

            document.getElementById("profilRingkasAtas").innerText =
              institusi.deskripsi;

            /* =========================
              HISTORI AKREDITASI AKTIF
              ========================= */
            const historiAktif = histori[histori.length - 1];

            document.getElementById("profilSK").innerHTML = `
              <strong>Akreditasi:</strong> ${historiAktif.kategori_akreditasi}<br>
              <strong>Nomor SK:</strong> ${historiAktif.nomor_sk}<br>
              <strong>Masa Berlaku:</strong> ${historiAktif.masa_berlaku}<br>
              <a href="${historiAktif.link_sk}" target="_blank"
                style="text-decoration:none;color:#20c997;">
                ðŸ“„ Lihat SK Penetapan
              </a>
            `;

            /* =========================
              SERTIFIKAT AKREDITASI
              ========================= */
            let sertifikatHtml = `
              <div class="feature-item mb-4">
                <p class="lead">
                  <strong>Sertifikat Akreditasi</strong>
                </p>
                <div class="row g-3">
            `;

            if (sertifikat.length === 0) {
              sertifikatHtml += `<p class="text-muted">Belum ada sertifikat.</p>`;
            } else {
              sertifikat.forEach((s) => {
                sertifikatHtml += `
                  <div class="col-md-6">
                    <img
                      src="http://localhost:5000/${s.file_path}"
                      class="img-fluid rounded shadow-sm zoomable-img"
                      alt="${s.keterangan}"
                      data-img="http://localhost:5000/${s.file_path}"
                    />
                    <small class="d-block mt-2">${s.keterangan}</small>
                  </div>
                `;
              });
            }

            sertifikatHtml += `</div></div>`;

            /* =========================
              TIM KERJA
              ========================= */
            let timHtml = `
              <div class="feature-item mb-4">
                <p class="lead"><strong>Tim Diklat</strong></p>
                <ul class="ps-3">
            `;

            if (timKerja.length === 0) {
              timHtml += `<li class="text-muted">Data tim belum tersedia</li>`;
            } else {
              timKerja.forEach((t) => {
                timHtml += `<li>${t.jabatan}</li>`;
              });
            }

            timHtml += `</ul></div>`;

            /* =========================
              RENDER KE HALAMAN
              ========================= */
            document.getElementById("profilDiklatContent").innerHTML = `
              ${sertifikatHtml}
              ${timHtml}
            `;

            /* =========================
              ZOOM IMAGE MODAL (WAJIB SETELAH innerHTML)
              ========================= */
            const modal = document.getElementById("imageModal");
            const modalImg = document.getElementById("modalImage");
            const captionText = document.getElementById("modalCaption");
            const closeBtn = document.querySelector(".img-modal-close");

            document.querySelectorAll(".zoomable-img").forEach((img) => {
              img.addEventListener("click", () => {
                modal.style.display = "flex";
                modalImg.src = img.dataset.img;
                // captionText.innerText = img.alt || "";
              });
            });

            closeBtn.onclick = () => {
              modal.style.display = "none";
            };

            modal.onclick = (e) => {
              if (e.target === modal) {
                modal.style.display = "none";
              }
            };

            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                modal.style.display = "none";
              }
            });
          } catch (err) {
            console.error("Gagal load profil diklat:", err);
          }
        });
      </script>

      <!-- MODAL ZOOM GAMBAR SERTIFIKAT -->
      <div id="imageModal" class="img-modal">
        <span class="img-modal-close">&times;</span>
        <img class="img-modal-content" id="modalImage">
        <div class="img-modal-caption" id="modalCaption"></div>
      </div>

      <hr>

      <!-- Calendar Section -->
      <section>
        <div class="container section-title" data-aos="fade-up">
          <h2 style="text-align:center; margin-top:30px;">
            KALENDER JADWAL PELATIHAN
          </h2>

          <!-- ===== EXPORT EXCEL KALENDER ===== -->
          <div class="container text-center">
            <a
              id="btnDownloadKalender"
              href="#"
              class="btn btn-accent"
              style="padding:10px 18px; border-radius:8px;"
              target="_blank"
              download
            >
              Download Jadwal Pelatihan
            </a>
          </div>
          <!-- ===== END EXPORT ===== -->

          <div id="calendar"></div>

            <!-- FullCalendar JS -->
            <script>
              document.addEventListener("DOMContentLoaded", async function () {

                const btnKalender = document.getElementById("btnDownloadKalender");
                if (btnKalender) {
                  try {
                    const res = await fetch("http://localhost:5000/api/kalender/aktif/latest");
                    const data = await res.json();

                    if (!res.ok) {
                      btnKalender.innerText = "Kalender Belum Tersedia";
                      btnKalender.classList.add("disabled");
                    } else {
                      btnKalender.href = `http://localhost:5000/uploads/kalender/${data.file_kalender}`;
                      btnKalender.setAttribute("download", data.file_kalender);
                      btnKalender.innerText = `Download Kalender Pelatihan ${data.tahun}`;
                    }
                  } catch (err) {
                    console.error("Gagal load kalender:", err);
                    btnKalender.innerText = "Kalender Tidak Bisa Dimuat";
                    btnKalender.classList.add("disabled");
                  }
                }

                const calendarEl = document.getElementById("calendar");

                // === util aman (tidak kena H-1) ===
                function toYMD(dateObj) {
                  const y = dateObj.getFullYear();
                  const m = String(dateObj.getMonth() + 1).padStart(2, "0");
                  const d = String(dateObj.getDate()).padStart(2, "0");
                  return `${y}-${m}-${d}`;
                }

                function parseDateOnly(str) {
                  // str = "2026-01-25T17:00:00.000Z"
                  const d = new Date(str);        // parse UTC dari API
                  d.setHours(d.getHours() + 7);   // konversi ke WIB
                  d.setHours(0, 0, 0, 0);         // kunci ke awal hari
                  return d;
                }

                function formatDateOnly(date) {
                  const y = date.getFullYear();
                  const m = String(date.getMonth() + 1).padStart(2, "0");
                  const d = String(date.getDate()).padStart(2, "0");
                  return `${y}-${m}-${d}`;
                }

                function formatRupiah(angka) {
                  return new Intl.NumberFormat("id-ID", {
                    style: "currency",
                    currency: "IDR",
                    minimumFractionDigits: 0,
                  }).format(angka);
                }

                const calendar = new FullCalendar.Calendar(calendarEl, {
                  timeZone: "Asia/Jakarta",

                  initialView: "dayGridMonth",
                  fixedWeekCount: false,
                  displayEventTime: false,

                  headerToolbar: {
                    left: "prev,next today",
                    center: "title",
                    right: "dayGridMonth,timeGridWeek,listWeek",
                  },

                  eventDidMount: function (info) {
                    info.el.style.cursor = "pointer";
                  },

                  events: async function (fetchInfo, successCallback, failureCallback) {
                    try {
                      const response = await fetch("http://localhost:5000/api/pelatihan");
                      const data = await response.json();

                      // ===============================
                      // FILTER: hanya tampilkan status "publish"
                      // ===============================
                      const filteredData = data.filter(item => item.status === "publish");

                      // ===============================
                      // MAPPING KE FULLCALENDAR
                      // ===============================
                      const mapped = [];

                      filteredData.forEach(item => {
                        const color = item.warna || "#3498db";

                        let start = parseDateOnly(item.tanggal_mulai);
                        let end = parseDateOnly(item.tanggal_selesai);

                        // loop per hari
                        while (start <= end) {
                          mapped.push({
                            id: item.id_pelatihan + "_" + formatDateOnly(start),
                            title: item.nama_pelatihan,
                            start: formatDateOnly(start),
                            allDay: true,

                            backgroundColor: color,
                            borderColor: color,
                            textColor: "#ffffff",

                            extendedProps: {
                              jumlah_jpl:item.jumlah_jpl,
                              kriteria_peserta:item.kriteria_peserta,
                              kategori: item.kategori,
                              kuota: item.sisa_kuota,
                              totalKuota: item.kuota,
                              lokasi: item.lokasi,
                              tanggal_mulai: item.tanggal_mulai,
                              tanggal_selesai: item.tanggal_selesai,
                              harga:item.harga,
                              flyer_url: item.flyer_url,
                            }
                          });

                          // maju ke hari berikutnya
                          start.setDate(start.getDate() + 1);
                        }
                      });

                      successCallback(mapped);
                    } catch (err) {
                      console.error("Gagal load event:", err);
                      failureCallback(err);
                    }
                  },

                  eventClick: function (info) {

                    function formatTanggal(tanggal) {
                      return new Date(tanggal).toLocaleDateString("id-ID", {
                        day: "2-digit",
                        month: "long",
                        year: "numeric",
                      });
                    }

                    document.getElementById("modalTitle").innerText = info.event.title;
                    document.getElementById("modalJumlah_jpl").innerText = info.event.extendedProps.jumlah_jpl;

                    document.getElementById("modalKategori").innerText =
                      info.event.extendedProps.kategori || "-";

                    document.getElementById("modalKriteria_peserta").innerText =
                      info.event.extendedProps.kriteria_peserta;

                    document.getElementById("modalMulai").innerText =
                      formatTanggal(info.event.extendedProps.tanggal_mulai);

                    document.getElementById("modalSelesai").innerText =
                      formatTanggal(info.event.extendedProps.tanggal_selesai);

                      document.getElementById("modalLokasi").innerText =
                      info.event.extendedProps.lokasi;

                    document.getElementById("modalPeserta").innerText =
                      info.event.extendedProps.kuota +
                      " / " +
                      info.event.extendedProps.totalKuota;

                    const harga = Number(info.event.extendedProps.harga) || 0;

                    document.getElementById("modalHarga").innerText =
                      harga > 0 ? formatRupiah(harga) : "Gratis";

                    // ambil elemen tombol
                    const btnDetail = document.getElementById("btnDetail");

                    // === FLYER ===
                    const flyerWrapper = document.getElementById("modalFlyerWrapper");
                    const flyerImg = document.getElementById("modalFlyer");
                    const flyerEmpty = document.getElementById("modalFlyerEmpty");

                    const flyer = info.event.extendedProps.flyer_url;

                    if (flyer) {
                      flyerImg.src = "http://localhost:5000/uploads/flyer/" + flyer;
                      flyerWrapper.classList.remove("d-none");
                      flyerEmpty.classList.add("d-none");
                    } else {
                      flyerImg.src = "";
                      flyerWrapper.classList.add("d-none");
                      flyerEmpty.classList.remove("d-none");
                    }

                    // AMBIL KUOTA SISANYA (di sini error kamu tadi)
                    let kuotaSisa = Number(info.event.extendedProps.kuota) || 0;
                    const totalKuota = Number(info.event.extendedProps.totalKuota) || 0;

                    // ===============================
                    // LOGIKA 1 â€” CEK EXPIRED (tanggal mulai sudah lewat)
                    // ===============================
                    const today = new Date().setHours(0, 0, 0, 0);
                    const eventDate = new Date(
                      info.event.extendedProps.tanggal_mulai
                    ).setHours(0, 0, 0, 0);

                    if (today > eventDate) {
                      // Anggap kuota 0 di tampilan & logika
                      kuotaSisa = 0;

                      document.getElementById("modalPeserta").innerText =
                        `0 / ${totalKuota}`;

                      btnDetail.innerText = "Pendaftaran Ditutup";
                      btnDetail.style.background = "#777";
                      btnDetail.style.cursor = "not-allowed";
                      btnDetail.onclick = null;
                    }

                    // ===============================
                    // LOGIKA KUOTA PENUH
                    // ===============================
                    if (kuotaSisa <= 0) {
                      btnDetail.innerText = "Kuota Penuh";
                      btnDetail.style.background = "#777";
                      btnDetail.style.cursor = "not-allowed";
                      btnDetail.onclick = null;
                    } else {
                      btnDetail.innerText = "Daftar Pelatihan";
                      btnDetail.style.background = "#28c7a8";
                      btnDetail.style.cursor = "pointer";

                      const realId = info.event.id.split("_")[0];

                      btnDetail.onclick = function () {
                        window.location.href =
                          "/pelatihanmargono/frontend/daftarpelatihan.html?id=" + realId;
                      };
                    }
                    bootstrap.Modal.getOrCreateInstance(
                      document.getElementById("modalPelatihan")
                    ).show();
                  }
                })

                calendar.render();
              });
            </script>

          <!-- ==== MODAL DETAIL KALENDER PELATIHAN ==== -->
          <div class="modal fade" id="modalPelatihan" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content">

                <div class="modal-header bg-accent text-white">
                  <h5 class="modal-title">Detail Pelatihan</h5>
                  <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                  <h5 class="fw-bold mb-4 text-center" id="modalTitle"></h5>

                  <div class="row g-4">

                    <!-- === KOLOM KIRI: FLYER === -->
                    <div class="col-md-5 text-center">
                      <div id="modalFlyerWrapper" class="d-none">
                        <img
                          id="modalFlyer"
                          src=""
                          alt="Flyer Pelatihan"
                          class="img-fluid rounded shadow-sm"
                          style="max-height: 420px; object-fit: contain;"
                        />
                      </div>

                      <!-- fallback kalau tidak ada flyer -->
                      <div id="modalFlyerEmpty" class="text-muted small d-none">
                        Flyer belum tersedia
                      </div>
                    </div>

                    <!-- === KOLOM KANAN: DETAIL === -->
                    <div class="col-md-7 ps-md-2 mt-3">

                      <table class="table table-sm align-middle detail-table">
                        <tbody>
                          <tr>
                            <th>Jumlah JPL</th>
                            <td><span id="modalJumlah_jpl"></span></td>
                          </tr>
                          <tr>
                            <th>Kategori</th>
                            <td><span id="modalKategori"></span></td>
                          </tr>
                          <tr>
                            <th>Kriteria</th>
                            <td><span id="modalKriteria_peserta"></span></td>
                          </tr>
                          <tr>
                            <th>Mulai</th>
                            <td><span id="modalMulai"></span></td>
                          </tr>
                          <tr>
                            <th>Selesai</th>
                            <td><span id="modalSelesai"></span></td>
                          </tr>
                          <tr>
                            <th>Lokasi</th>
                            <td><span id="modalLokasi"></span></td>
                          </tr>
                          <tr>
                            <th>Kuota</th>
                            <td><span id="modalPeserta"></span></td>
                          </tr>
                          <tr>
                            <th>Biaya</th>
                            <td><span id="modalHarga"></span></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <div class="modal-footer">
                  <a id="btnDetail" class="btn btn-primary">Daftar Pelatihan</a>
                  <button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>

              </div>
            </div>
          </div>

          <!-- ==== END MODAL DETAIL PELATIHAN ==== -->
        </div>
      </section>
      <!-- </section kalender> -->

      <hr>

      <!-- MENU PELATIHAN Section -->
        <section class="services section">
            <div class="container section-title mt-0" data-aos="fade-up">
              <h2>MENU PELATIHAN</h2>

              <!-- === FILTER KATEGORI === -->
              <div class="services-tabs">
                <!-- === FILTER KATEGORI (NAV-TABS) === -->
                <ul class="nav nav-tabs justify-content-center mb-4" id="kategoriTabs">
                  <li class="nav-item">
                    <button
                      class="nav-link"
                      onclick="filterKategori('all', this)"
                    >
                      Semua
                    </button>
                  </li>

                  <li class="nav-item">
                    <button
                      class="nav-link"
                      onclick="filterKategori('Nakes', this)"
                    >
                      Nakes
                    </button>
                  </li>

                  <li class="nav-item">
                    <button
                      class="nav-link"
                      onclick="filterKategori('Non Nakes', this)"
                    >
                      Non-Nakes
                    </button>
                  </li>

                  <li class="nav-item">
                    <button class="nav-link"
                      onclick="filterKategori('terlaksana', this)">
                      Terlaksana
                    </button>
                  </li>

                </ul>
              </div>
              <!-- End Section Title -->

              <!-- ==== MODAL DETAIL MENU PELATIHAN ==== -->
              <div class="modal fade" id="modalPelatihan" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content">

                    <div class="modal-header bg-accent text-white">
                      <h5 class="modal-title">Detail Pelatihan</h5>
                      <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">

                      <h5 class="fw-bold mb-4 text-center" id="modalTitle"></h5>

                      <div class="row g-4">

                        <!-- KOLOM KIRI: FLYER -->
                        <div class="col-md-5 text-center">
                          <div id="modalFlyerWrapper" class="d-none">
                            <img
                              id="modalFlyer"
                              class="img-fluid rounded shadow-sm"
                              style="max-height:420px; object-fit:contain;"
                            />
                          </div>
                          <div id="modalFlyerEmpty" class="text-muted small d-none">
                            Flyer belum tersedia
                          </div>
                        </div>

                        <!-- KOLOM KANAN: DETAIL -->
                        <div class="col-md-7 ps-md-2 mt-3">

                          <table class="table table-sm align-middle detail-table">
                            <tbody>
                              <tr>
                                <th>Jumlah JPL</th>
                                <td><span id="modalJumlah_jpl"></span></td>
                              </tr>
                              <tr>
                                <th>Kategori</th>
                                <td><span id="modalKategori"></span></td>
                              </tr>
                              <tr>
                                <th>Kriteria</th>
                                <td><span id="modalKriteria_peserta"></span></td>
                              </tr>
                              <tr>
                                <th>Mulai</th>
                                <td><span id="modalMulai"></span></td>
                              </tr>
                              <tr>
                                <th>Selesai</th>
                                <td><span id="modalSelesai"></span></td>
                              </tr>
                              <tr>
                                <th>Lokasi</th>
                                <td><span id="modalLokasi"></span></td>
                              </tr>
                              <tr>
                                <th>Kuota</th>
                                <td><span id="modalPeserta"></span></td>
                              </tr>
                              <tr>
                                <th>Biaya</th>
                                <td><span id="modalHarga"></span></td>
                              </tr>
                            </tbody>
                          </table>

                        </div>
                      </div>
                    </div>

                    <div class="modal-footer">
                      <a id="btnDetail" class="btn btn-primary">Daftar Pelatihan</a>
                      <button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    </div>

                  </div>
                </div>
              </div>
              <!-- ==== END MODAL ==== -->

                <div class="row gy-4" id="menupelatihanContainer">
                  <!-- End Script JS Menu Pelatihan -->
                </div>
              </div>
            </div>
          </section>

          <!-- ================= MODAL ZOOM FLYER ================= -->
                  <div class="modal fade" id="modalZoomFlyer" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                      <div class="modal-content modal-flyer-auto">

                        <!-- HEADER -->
                        <div class="modal-header bg-accent text-white">
                          <!-- <h5 class="modal-title">Preview Flyer</h5> -->
                          <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                          ></button>
                        </div>

                        <!-- BODY -->
                        <div class="modal-body text-center p-2">
                          <img
                            id="zoomFlyerImage"
                            class="img-fluid rounded shadow flyer-auto"
                            alt="Flyer Preview"
                          />
                        </div>

                      </div>
                    </div>
                  </div>
                  <!-- ================= END MODAL ================= -->

                  <script>
                      const API = "http://localhost:5000/api/pelatihan";

                      // Menyimpan semua pelatihan publish
                      let allPelatihan = [];

                      // ====== FORMAT TANGGAL & WAKTU ======
                      function formatTanggal(tanggal) {
                        return new Date(tanggal).toLocaleDateString("id-ID", {
                          day: "2-digit",
                          month: "long",
                          year: "numeric",
                        });
                      }

                      // ====== FORMAT RUPIAH  ======
                      function formatRupiah(angka) {
                        const nilai = Number(angka) || 0;
                        return "Rp " + nilai.toLocaleString("id-ID");
                      }

                      // ===================== LOAD LIST PELATIHAN (CARD) =====================
                      async function loadPelatihan() {
                        const res = await fetch(API);
                        const data = await res.json();

                        // Urutkan dari yg masih bisa daftar
                        allPelatihan = data
                          .filter(item => item.status === "publish")
                          .sort((a, b) => {
                            const today = new Date().setHours(0, 0, 0, 0);

                            const aDate = new Date(a.tanggal_mulai).setHours(0, 0, 0, 0);
                            const bDate = new Date(b.tanggal_mulai).setHours(0, 0, 0, 0);

                            const aAvailable = a.sisa_kuota > 0 && aDate >= today;
                            const bAvailable = b.sisa_kuota > 0 && bDate >= today;

                            if (aAvailable && !bAvailable) return -1;
                            if (!aAvailable && bAvailable) return 1;

                            if (aAvailable && bAvailable) return aDate - bDate;

                            return bDate - aDate;
                          });

                        renderPelatihan(allPelatihan);
                      }

                      // ===================== RENDER CARD PELATIHAN =====================
                      function renderPelatihan(list) {
                        const container = document.getElementById("menupelatihanContainer");
                        container.innerHTML = "";

                        if (list.length === 0) {
                          container.innerHTML = `
                            <div class="col-12 text-center py-5">
                              <h5 class="text-muted">
                                Tidak ada pelatihan yang tersedia untuk kategori ini.
                              </h5>
                            </div>
                          `;
                          return;
                        }

                        list.forEach(p => {
                          container.innerHTML += `
                            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
                              <div class="department-card">

                                <div
                                  class="department-image flyer-rectangle"
                                  onclick="zoomFlyer('${p.flyer_url}')"
                                >
                                  <img
                                    src="http://localhost:5000/uploads/flyer/${p.flyer_url}"
                                    class="img-fluid"
                                    style="cursor: zoom-in;"
                                  >
                                </div>

                                <div class="department-content">
                                  <div class="department-icon">
                                  </div>

                                  <h3
                                    class="pelatihan-title"
                                    onclick="openModal(${p.id_pelatihan})"
                                    style="cursor:pointer;"
                                  >
                                    ${p.nama_pelatihan}
                                  </h3>
                                </div>

                              </div>
                            </div>
                          `;
                        });
                      }

                      loadPelatihan();

                      function setActiveTab(button) {
                        document.querySelectorAll("#kategoriTabs .nav-link")
                          .forEach(tab => tab.classList.remove("active"));

                        if (button) {
                          button.classList.add("active");
                        }
                      }

                      function filterKategori(kategori, button) {
                        setActiveTab(button);

                        const today = new Date();
                        today.setHours(0, 0, 0, 0);

                        let hasil = [];

                        if (kategori === "all") {
                          hasil = allPelatihan;
                        } 
                        else if (kategori === "terlaksana") {
                          hasil = allPelatihan.filter(p => {
                            const tanggalMulai = new Date(p.tanggal_mulai);
                            tanggalMulai.setHours(0, 0, 0, 0);
                            return tanggalMulai < today;
                          });
                        } 
                        else {
                          hasil = allPelatihan.filter(p => p.kategori === kategori);
                        }

                        renderPelatihan(hasil);
                      }

                      async function openModal(id) {
                        const res = await fetch(API);
                        const data = await res.json();

                        const p = data.find(x => x.id_pelatihan == id);
                        const btnDetail = document.getElementById("btnDetail");

                        document.getElementById("modalFlyer").src =
                          `http://localhost:5000/uploads/flyer/${p.flyer_url}`;

                        document.getElementById("modalTitle").innerText = p.nama_pelatihan;
                        document.getElementById("modalJumlah_jpl").innerText = p.jumlah_jpl;
                        document.getElementById("modalKategori").innerText = p.kategori;
                        document.getElementById("modalKriteria_peserta").innerText = p.kriteria_peserta;

                        document.getElementById("modalMulai").innerText =
                          formatTanggal(p.tanggal_mulai);

                        document.getElementById("modalSelesai").innerText =
                          formatTanggal(p.tanggal_selesai);

                        document.getElementById("modalLokasi").innerText = p.lokasi;
                        document.getElementById("modalPeserta").innerText =
                          p.sisa_kuota + " / " + p.kuota;

                        document.getElementById("modalHarga").innerText =
                          p.harga && p.harga > 0 ? formatRupiah(p.harga) : "Gratis";

                          // ===============================
                          // FLYER (SAMA DENGAN MODAL KALENDER)
                          // ===============================
                          const flyerWrapper = document.getElementById("modalFlyerWrapper");
                          const flyerImg = document.getElementById("modalFlyer");
                          const flyerEmpty = document.getElementById("modalFlyerEmpty");

                          if (p.flyer_url) {
                            flyerImg.src = "http://localhost:5000/uploads/flyer/" + p.flyer_url;
                            flyerWrapper.classList.remove("d-none");
                            flyerEmpty.classList.add("d-none");
                          } else {
                            flyerImg.src = "";
                            flyerWrapper.classList.add("d-none");
                            flyerEmpty.classList.remove("d-none");
                          }

                        const today = new Date().setHours(0, 0, 0, 0);
                        const eventDate = new Date(p.tanggal_mulai).setHours(0, 0, 0, 0);

                        let sisaKuota = Number(p.sisa_kuota) || 0;
                        const totalKuota = Number(p.kuota) || 0;

                        if (today > eventDate) {
                          sisaKuota = 0;
                          document.getElementById("modalPeserta").innerText =
                            `0 / ${totalKuota}`;

                          btnDetail.innerText = "Pendaftaran Ditutup";
                          btnDetail.style.background = "#777";
                          btnDetail.style.cursor = "not-allowed";
                          btnDetail.onclick = null;

                          bootstrap.Modal.getOrCreateInstance(
                            document.getElementById("modalPelatihan")
                          ).show();
                          return;
                        }

                        if (p.sisa_kuota <= 0) {
                          btnDetail.innerText = "Kuota Penuh";
                          btnDetail.style.background = "#777";
                          btnDetail.style.cursor = "not-allowed";
                          btnDetail.onclick = null;
                        } else {
                          btnDetail.innerText = "Daftar Pelatihan";
                          btnDetail.style.background = "#28c7a8";
                          btnDetail.style.cursor = "pointer";

                          btnDetail.onclick = function () {
                            window.location.href =
                              `daftarpelatihan.html?id=${p.id_pelatihan}`;
                          };
                        }

                        bootstrap.Modal.getOrCreateInstance(
                          document.getElementById("modalPelatihan")
                        ).show();
                      }

                      function tutupModal() {
                        document.getElementById("modalPelatihan").style.display = "none";
                      }

                      function zoomFlyer(flyerUrl) {
                        if (!flyerUrl) return;

                        const img = document.getElementById("zoomFlyerImage");
                        img.src = `http://localhost:5000/uploads/flyer/${flyerUrl}`;

                        const modal = bootstrap.Modal.getOrCreateInstance(
                          document.getElementById("modalZoomFlyer")
                        );

                        modal.show();
                      }
                  </script>

        <hr>

      <!-- Call To Action Section -->
      <section id="call-to-action" class="call-to-action section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
          <div class="container section-title" data-aos="fade-up">
            <h2 style="font-weight: bold">ALUR PENDAFTARAN</h3>
              <div class="row features-row" data-aos="fade-up" data-aos-delay="400">
                <div class="col-12 d-flex justify-content-center">
                  <div class="feature-card text-center w-100" style="max-width: 800px";>
                    <div class="icon-wrapper">
                      <i class="bi bi-journal-bookmark-fill"></i>
                    </div>
                      <h5>Bagaimana Cara Mengikuti Diklat <br> di RSUD Prof. Dr. Margono Soekarjo Purwokerto?</h5>
                    <a href="alurpendaftaran.html" class="feature-link">
                      <span>Pelajari Selengkapnya</span>
                      <i class="bi bi-arrow-right"></i>
                    </a>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </section>
    </main>

  <footer id="footer" class="footer position-relative light-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">DIKLAT RSMS</span>
          </a>
          <div class="footer-contact pt-3">
            <p>Jl. Dr. Gumbreg No.1, Kebontebu, Berkoh, </p>
            <p>Kec. Purwokerto Sel., Kabupaten Banyumas,</p>
            <p>Jawa Tengah 53146</p>
            <p class="mt-3"><strong>Phone:</strong> <span>(0281) 632704</span></p>
            <p><strong>Email:</strong> <span>rsmargono@jatengprov.go.id</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href="https://x.com/rsudmargono"><i class="bi bi-twitter-x"></i></a>
            <a href="https://www.facebook.com/RSMargono/"><i class="bi bi-facebook"></i></a>
            <a href="https://www.instagram.com/rsudmargono/"><i class="bi bi-instagram"></i></a>
            <a href="https://www.youtube.com/@rsmargono"><i class="bi bi-youtube"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="contact.html">Kontak</a></li>
            <li><a href="gallery.html">Gallery</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Pelatihan</h4>
          <ul>
            <li><a href="menupelatihan.html">Menu Pelatihan</a></li>
            <li><a href="daftarpelatihan.html">Daftar Pelatihan</a></li>
            <li><a href="kalender.html">Kalender Pelatihan</a></li>
            <li><a href="alurpendaftaran.html">Alur Pendaftaran</a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-3 footer-links">
          <h4>Tim & Mitra Pelatihan</h4>
          <ul>
            <li><a href="fasilitator.html">Profesional Fasilitor dan Instruktur</a></li>
            <li><a href="penyelenggara.html">Tim Penyelenggara Pelatihan</a></li>
            <li><a href="instruktur.html">Institusi Kerjasama</a></li>
          </ul>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">RSUD Prof. Dr. Margono Soekarjo</strong></p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        <!-- Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> -->
      </div>
    </div>

  </footer>

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const isRegistered = localStorage.getItem("isRegistered");
        const btnLogin = document.getElementById("btn-login");

        if (isRegistered && btnLogin) {
          btnLogin.style.display = "none"; // sembunyikan tombol login
        }
      });
    </script>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
  </body>
</html>
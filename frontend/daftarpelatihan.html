<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Daftar Pelatihan - DIKLAT RSMS</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicons -->
    <link
      rel="icon"
      href="/pelatihanmargono/backend/uploads/foto/LogoWeb.png"
      type="image/png"
      sizes="512x512"
    />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="assets/vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <link
      href="assets/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />

    <!-- Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet" />
  </head>

  <body class="appointment-page">
    <!-- ======= HEADER ======= -->
    <header id="header" class="header d-flex align-items-center fixed-top">
      <div
        class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between"
      >
        <a
          href="index.html"
          class="logo d-flex align-items-center me-auto me-xl-0"
        >
          <img
            src="/pelatihanmargono/backend/uploads/foto/LogoWeb.png"
            alt="Logo RSMS"
            style="height: 40px; margin-right: 8px"
          />

          <g id="bgCarrier" stroke-width="0"></g>
          <g
            id="tracerCarrier"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></g>
          <g id="iconCarrier">
            <path
              d="M22 22L2 22"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              d="M17 22V6C17 4.11438 17 3.17157 16.4142 2.58579C15.8284 2 14.8856 2 13 2H11C9.11438 2 8.17157 2 7.58579 2.58579C7 3.17157 7 4.11438 7 6V22"
              stroke="currentColor"
              stroke-width="1.5"
            ></path>
            <path
              opacity="0.5"
              d="M21 22V8.5C21 7.09554 21 6.39331 20.6629 5.88886C20.517 5.67048 20.3295 5.48298 20.1111 5.33706C19.6067 5 18.9045 5 17.5 5"
              stroke="currentColor"
              stroke-width="1.5"
            ></path>
            <path
              opacity="0.5"
              d="M3 22V8.5C3 7.09554 3 6.39331 3.33706 5.88886C3.48298 5.67048 3.67048 5.48298 3.88886 5.33706C4.39331 5 5.09554 5 6.5 5"
              stroke="currentColor"
              stroke-width="1.5"
            ></path>
            <path
              d="M12 22V19"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M10 12H14"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M5.5 11H7"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M5.5 14H7"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M17 11H18.5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M17 14H18.5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M5.5 8H7"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M17 8H18.5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              opacity="0.5"
              d="M10 15H14"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            ></path>
            <path
              d="M12 9V5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
            <path
              d="M14 7L10 7"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
          </g>

          <h1 class="sitename">DIKLAT RSMS</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html">Home</a></li>

            <li class="dropdown">
              <a href="#"
                ><span>Pelatihan</span
                ><i class="bi bi-chevron-down toggle-dropdown"></i
              ></a>
              <ul>
                <li><a href="menupelatihan.html">Menu Pelatihan</a></li>
                <li><a href="kalender.html">Kalender Pelatihan</a></li>
                <li>
                  <a href="daftarpelatihan.html" class="active"
                    >Daftar Pelatihan</a
                  >
                </li>
                <li><a href="alurpendaftaran.html">Alur Pendaftaran</a></li>
                <li><a href="gallery.html">Gallery</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#"
                ><span>Tim & Mitra Pelatihan</span
                ><i class="bi bi-chevron-down toggle-dropdown"></i
              ></a>
              <ul>
                <li>
                  <a href="fasilitator.html"
                    >Profesional Fasilitor dan Instuktur Tersertifikasi</a
                  >
                </li>
                <li>
                  <a href="penyelenggara.html"
                    >Tim Penyelenggara Pelatihan Tersertifikasi</a
                  >
                </li>
                <li><a href="intitusi.html">Institusi Kerjasama</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#"
                ><span>Tentang Kami</span
                ><i class="bi bi-chevron-down toggle-dropdown"></i
              ></a>
              <ul>
                <li><a href="profil.html">Profil Diklat</a></li>
                <li>
                  <a href="struktur_organisasi.html">Struktur Organisasi</a>
                </li>
                <li><a href="kritiksaran.html">Kritik dan Saran</a></li>
              </ul>
            </li>

            <li><a href="kritiksaran.html">Kritik Saran</a></li>

            <li class="ms-lg-3">
              <a href="daftarpelatihan.html" class="btn btn-accent nav-cta">
                Daftar Pelatihan
              </a>
            </li>
          </ul>

          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>
      </div>
    </header>

    <!-- ======= MAIN ======= -->
    <main class="main">
      <div class="page-title">
        <div class="title-wrapper">
          <h1>DAFTAR PELATIHAN</h1>
          <br />
          <div>
            <h4>Selamat datang di Formulir Pendaftaran kami!</h4>
            <p>
              Formulir pendaftaran kami berisi beberapa kelengkapan data, di
              mana Anda dapat memberikan informasi pribadi Anda secara rinci.
              Kami menjamin kerahasiaan dan keamanan data yang Anda berikan
              kepada kami.
            </p>
          </div>
        </div>
      </div>

      <!-- Appointmnet Section -->
      <section id="appointmnet" class="appointmnet section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
          <div class="row gy-4">
            <!-- Form Daftar Pelatihan -->
            <div class="col-lg-12 mb-5">
              <div
                class="appointment-form-wrapper"
                data-aos="fade-up"
                data-aos-delay="200"
              >
                <form id="formPendaftaran" class="appointment-form">
                  <div class="row gy-3">
                    <div class="col-md-12">
                      <label class="form-label">Menu Pelatihan:</label>
                      <select
                        id="menupelatihan"
                        name="id_pelatihan"
                        class="form-control"
                        required
                      >
                        <option value="">-- Pilih Pelatihan --</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Gelar Depan Akademik:</label>
                      <input
                        type="text"
                        name="gelar_depan"
                        class="form-control"
                        placeholder="Gelar Depan Akademik (Abaikan jika tidak ada)"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">NIP:</label>
                      <input
                        type="text"
                        name="nip"
                        class="form-control"
                        placeholder="(NIP bagi ASN atau NRP) Tanpa Spasi"
                        inputmode="numeric"
                        maxlength="18"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        required
                      />

                      <small class="text-danger">
                        *Pastikan NIP yang Anda daftarkan belum pernah digunakan
                        untuk mendaftar pada pelatihan yang sama.
                      </small>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Nama Lengkap:</label>
                      <input
                        type="text"
                        name="nama_peserta"
                        class="form-control"
                        placeholder="Nama Lengkap"
                        required
                      />

                      <small class="text-danger">
                        *Nama peserta tidak boleh terdaftar lebih dari satu kali
                        pada pelatihan yang sama.
                      </small>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label"
                        >Nomor Induk Kependudukan:</label
                      >
                      <input
                        type="text"
                        name="nik"
                        class="form-control"
                        placeholder="Nomor Induk Kependudukan / KTP (16 Digit)"
                        maxlength="16"
                        inputmode="numeric"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        required
                      />

                      <small class="text-danger">
                        *NIK hanya dapat digunakan untuk mendaftar satu kali
                        pada setiap pelatihan yang sama.
                      </small>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Gelar Belakang Akademik:</label>
                      <input
                        type="text"
                        name="gelar_belakang"
                        class="form-control"
                        placeholder="Gelar Belakang Akademik (Abaikan jika tidak ada)"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Asal Instansi:</label>
                      <input
                        type="text"
                        name="asal_instansi"
                        class="form-control"
                        placeholder="Asal Instansi"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Tanggal Lahir:</label>
                      <input
                        type="date"
                        name="tanggal_lahir"
                        class="form-control"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Tempat Lahir:</label>
                      <input
                        type="text"
                        name="tempat_lahir"
                        class="form-control"
                        placeholder="Tempat Lahir"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Pendidikan Terakhir:</label>
                      <select name="pendidikan" class="form-control" required>
                        <option value="">Pilih Pendidikan</option>
                        <option value="SMA">SMA</option>
                        <option value="D1">D1</option>
                        <option value="D2">D2</option>
                        <option value="D3">D3</option>
                        <option value="D4/S1">D4/S1</option>
                        <option value="S2">S2</option>
                        <option value="S3">S3</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Jenis Kelamin:</label>
                      <select
                        name="jenis_kelamin"
                        class="form-control"
                        required
                      >
                        <option value="">Pilih Jenis Kelamin</option>
                        <option value="Pria">Pria</option>
                        <option value="Wanita">Wanita</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Agama:</label>
                      <select name="agama" class="form-control" required>
                        <option value="">Pilih Agama</option>
                        <option value="Islam">Islam</option>
                        <option value="Kristen Protestan">
                          Kristen Protestan
                        </option>
                        <option value="Kristen Katolik">Kristen Katolik</option>
                        <option value="Buddha">Buddha</option>
                        <option value="Konghucu">Konghucu</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Status Pegawai:</label>
                      <select
                        name="status_pegawai"
                        class="form-control"
                        required
                      >
                        <option value="">Pilih Status Pegawai</option>
                        <option value="ASN Kemenkes">ASN Kemenkes</option>
                        <option value="ASN Non Kemenkes">
                          ASN Non Kemenkes
                        </option>
                        <option value="Non ASN">Non ASN</option>
                      </select>
                    </div>

                    <!-- PANGKAT / GOLONGAN -->
                    <div class="col-md-6 d-none" id="pangkatContainer">
                      <label class="form-label">Pangkat / Golongan:</label>
                      <select
                        name="pangkat_golongan"
                        id="pangkatGolongan"
                        class="form-control"
                      >
                        <option value="">Pilih Pangkat/Golongan</option>
                        <option value="PPPK">PPPK</option>
                        <option value="PENGATUR-II/c">PENGATUR-II/c</option>
                        <option value="PENGATUR TINGKAT I-II/d">
                          PENGATUR TINGKAT I-II/d
                        </option>
                        <option value="PENATA MUDA-III/a">
                          PENATA MUDA-III/a
                        </option>
                        <option value="PENATA MUDA TINGKAT I-III/b">
                          PENATA MUDA TINGKAT I-III/b
                        </option>
                        <option value="PENATA-III/c">PENATA-III/c</option>
                        <option value="PENATA TINGKAT I-III/d">
                          PENATA TINGKAT I-III/d
                        </option>
                        <option value="PEMBINA-IV/a">PEMBINA-IV/a</option>
                        <option value="PEMBINA TINGKAT I-IV/b">
                          PEMBINA TINGKAT I-IV/b
                        </option>
                        <option value="PEMBINA UTAMA MUDA-IV/c">
                          PEMBINA UTAMA MUDA-IV/c
                        </option>
                        <option value="PEMBINA UTAMA MADYA-IV/d">
                          PEMBINA UTAMA MADYA-IV/d
                        </option>
                        <option value="PEMBINA UTAMA-IV/e">
                          PEMBINA UTAMA-IV/e
                        </option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Kabupaten Asal:</label>
                      <input
                        type="text"
                        name="kabupaten_asal"
                        class="form-control"
                        placeholder="Kabupaten Asal"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Provinsi Asal:</label>
                      <input
                        type="text"
                        name="provinsi_asal"
                        class="form-control"
                        placeholder="Provinsi Asal"
                      />
                    </div>

                    <div class="col-md-12">
                      <label class="form-label">Alamat Kantor:</label>
                      <input
                        type="text"
                        name="alamat_kantor"
                        class="form-control"
                        placeholder="Alamat Kantor"
                      />
                    </div>

                    <div class="col-md-12">
                      <label class="form-label">Alamat Rumah:</label>
                      <input
                        type="text"
                        name="alamat_rumah"
                        class="form-control"
                        placeholder="Alamat Rumah"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">No. WhatsApp:</label>
                      <input
                        type="text"
                        name="no_wa"
                        class="form-control"
                        placeholder="085600032xxx"
                        maxlength="15"
                        inputmode="numeric"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        required
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Email:</label>
                      <input
                        type="email"
                        name="email"
                        class="form-control"
                        placeholder="Email"
                        required
                      />
                      <small class="text-danger">
                        *Pastikan Email Anda menggunakan @gmail.com
                      </small>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Nomor STR:</label>
                      <input
                        type="text"
                        name="str"
                        class="form-control"
                        placeholder="STR (Abaikan jika tidak ada)"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Jenis Nakes:</label>
                      <select name="jenis_nakes" class="form-control" required>
                        <option value="">Pilih Jenis Nakes</option>
                        <option value="Dokter">Dokter</option>
                        <option value="Perawat">Perawat</option>
                        <option value="Bidan">Bidan</option>
                        <option value="Nutrisionis">Nutrisionis</option>
                        <option value="Apoteker">Apoteker</option>
                        <option value="Lain-lain">Lain-lain</option>
                      </select>
                    </div>

                    <!-- JABATAN (DINAMIS BERDASARKAN JENIS NAKES) -->
                    <div class="col-md-6 d-none" id="jabatanContainer">
                      <label class="form-label">Jabatan:</label>
                      <select
                        name="jabatan"
                        id="jabatanSelect"
                        class="form-control"
                      >
                        <option value="">Pilih Jabatan</option>
                      </select>
                      <small class="text-danger"
                        >*Contoh jika profesi adalah perawat maka untuk ASN
                        diisi Perawat Ahli Madya/Muda/Pertama, Perawat
                        Penyelia/Mahir/Terampil. Untuk Non ASN diisi Perawat
                      </small>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Kabupaten Kantor:</label>
                      <input
                        type="text"
                        name="kabupaten_kantor"
                        class="form-control"
                        placeholder="Kabupaten Kantor"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Provinsi Kantor:</label>
                      <input
                        type="text"
                        name="provinsi_kantor"
                        class="form-control"
                        placeholder="Provinsi Kantor"
                      />
                    </div>

                    <div class="col-md-12">
                      <label class="form-label">Upload Surat Tugas:</label>
                      <input
                        type="file"
                        name="surat_tugas"
                        class="form-control"
                        accept=".pdf,.jpg,.jpeg,.png"
                      />
                    </div>

                    <div class="mb-3">
                      <label for="foto_4x6" class="form-label"
                        >Foto 4 x 6</label
                      >
                      <input
                        type="file"
                        class="form-control"
                        id="foto_4x6"
                        name="foto_4x6"
                        accept=".jpg, .jpeg, .png"
                      />
                      <small class="text-danger">
                        *Background merah, menggunakan kemeja putih, menghadap
                        lurus ke depan. Untuk yang berhijab menggunakan kerudung
                        warna hitam/gelap, dan dasi panjang warna hitam/gelap.
                        Maksimal ukuran 1 Mb (format: JPG/JPEG/PNG).
                      </small>
                    </div>

                    <div class="col-12 mt-3">
                      <button type="submit" class="btn btn-accent w-100">
                        Daftar Pelatihan
                      </button>
                    </div>
                  </div>
                </form>
                <div id="result"></div>
              </div>
            </div>
          </div>
          <!-- End Appointment Form -->

          <!-- script Daftar Pelatihan -->
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              // =====================================================
              // ELEMENT REFERENCES
              // =====================================================
              const form = document.getElementById("formPendaftaran");

              const statusPegawaiSelect = document.querySelector(
                '[name="status_pegawai"]',
              );
              const pangkatContainer =
                document.getElementById("pangkatContainer");
              const pangkatSelect = document.getElementById("pangkatGolongan");

              const jenisNakesSelect = document.querySelector(
                '[name="jenis_nakes"]',
              );
              const jabatanContainer =
                document.getElementById("jabatanContainer");
              const jabatanSelect = document.getElementById("jabatanSelect");

              const modalKonfirmasi = new bootstrap.Modal(
                document.getElementById("modalKonfirmasi"),
              );

              // Pastikan saat pertama load pangkat jabatan tersembunyi
              pangkatContainer.classList.add("d-none");
              pangkatSelect.removeAttribute("required");

              // ==========================
              // SHOW / HIDE PANGKAT ASN
              // ==========================
              statusPegawaiSelect.addEventListener("change", function () {
                const value = this.value;

                // Default: sembunyikan
                pangkatContainer.classList.add("d-none");
                pangkatSelect.removeAttribute("required");
                pangkatSelect.value = "";

                // Hanya tampil kalau ASN
                if (value === "ASN Kemenkes" || value === "ASN Non Kemenkes") {
                  pangkatContainer.classList.remove("d-none");
                  pangkatSelect.setAttribute("required", "required");
                }
              });

              // =====================================================
              // DATA JABATAN PER PROFESI
              // =====================================================
              const jabatanOptions = {
                Dokter: [
                  "Dokter Ahli Madya",
                  "Dokter Ahli Muda",
                  "Dokter Ahli Pertama",
                  "Dokter",
                ],
                Perawat: [
                  "Perawat Ahli Madya",
                  "Perawat Ahli Muda",
                  "Perawat Ahli Pertama",
                  "Perawat Penyelia",
                  "Perawat Mahir",
                  "Perawat Terampil",
                  "Perawat",
                ],
                Bidan: [
                  "Bidan Ahli Madya",
                  "Bidan Ahli Muda",
                  "Bidan Ahli Pertama",
                  "Bidan Penyelia",
                  "Bidan Mahir",
                  "Bidan Terampil",
                  "Bidan",
                ],
                Nutrisionis: [
                  "Nutrisionis Ahli Madya",
                  "Nutrisionis Ahli Muda",
                  "Nutrisionis Ahli Pertama",
                  "Nutrisionis Terampil Penyelia",
                  "Nutrisionis Terampil Pelaksana Lanjutan",
                  "Nutrisionis Terampil Penyelia",
                  "Nutrisionis",
                ],
                Apoteker: [
                  "Apoteker Ahli Utama",
                  "Apoteker Ahli Madya",
                  "Apoteker Ahli Muda",
                  "Apoteker Ahli Pertama",
                  "Apoteker",
                ],
                "Lain-lain": ["Lain-lain"],
              };

              // =====================================================
              // JABATAN DINAMIS
              // =====================================================
              jenisNakesSelect.addEventListener("change", function () {
                const selected = this.value;

                jabatanSelect.innerHTML =
                  '<option value="">Pilih Jabatan</option>';

                if (jabatanOptions[selected]) {
                  jabatanContainer.classList.remove("d-none");
                  jabatanSelect.setAttribute("required", "required");

                  jabatanOptions[selected].forEach((jabatan) => {
                    const option = document.createElement("option");
                    option.value = jabatan;
                    option.textContent = jabatan;
                    jabatanSelect.appendChild(option);
                  });
                } else {
                  jabatanContainer.classList.add("d-none");
                  jabatanSelect.removeAttribute("required");
                  jabatanSelect.value = "";
                }
              });

              // ==========================================
              // Format tanggal ISO → DD/MM/YYYY
              // ==========================================
              function formatTanggalIndo(dateString) {
                const date = new Date(dateString);
                const d = String(date.getDate()).padStart(2, "0");
                const m = String(date.getMonth() + 1).padStart(2, "0");
                const y = date.getFullYear();
                return `${d}/${m}/${y}`;
              }

              // ======================
              // LOAD MENU PELATIHAN + FILTER TANGGAL + STATUS PUBLISH
              // ======================
              async function loadPelatihan() {
                console.log("Mengambil data pelatihan...");

                const res = await fetch("http://localhost:5000/api/pelatihan");
                if (!res.ok) {
                  console.error("Response error:", res.status);
                  return;
                }

                const data = await res.json();
                const select = document.getElementById("menupelatihan");
                const today = new Date().toISOString().split("T")[0];

                data.forEach((item) => {
                  // HANYA tampilkan status publish
                  if (item.status !== "publish") return;

                  const tanggalISO = item.tanggal_mulai;
                  if (!tanggalISO) return;

                  const tanggalOnly = tanggalISO.split("T")[0];

                  // Hanya tampilkan pelatihan yang belum lewat
                  if (tanggalOnly >= today) {
                    const opt = document.createElement("option");
                    opt.value = item.id_pelatihan;

                    const tanggalFormatted = formatTanggalIndo(tanggalISO);
                    opt.textContent = `${item.nama_pelatihan} - (${tanggalFormatted})`;

                    select.appendChild(opt);
                  }
                });
              }

              loadPelatihan();

              // =====================================================
              // SUBMIT HANDLER
              // =====================================================
              form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const jenisNakes = form.querySelector(
                  '[name="jenis_nakes"]',
                ).value;
                const jabatan = form.querySelector('[name="jabatan"]').value;

                if (jenisNakes && !jabatan) {
                  alert("Silakan pilih jabatan sesuai jenis nakes.");
                  return;
                }

                const nik = form.querySelector('[name="nik"]').value;
                const nip = form.querySelector('[name="nip"]').value;
                const id_pelatihan = form.querySelector(
                  '[name="id_pelatihan"]',
                ).value;

                if (!id_pelatihan) {
                  alert("Silakan pilih pelatihan.");
                  return;
                }

                // ======================
                // CEK DUPLIKAT
                // ======================
                const cek = await fetch(
                  `http://localhost:5000/api/pendaftaran/check-duplikat?id_pelatihan=${id_pelatihan}&nik=${nik}&nip=${nip}`,
                );
                const cekData = await cek.json();

                if (cekData.duplicate) {
                  showDuplicateModal(cekData.message);
                  return;
                }

                // Validasi Foto 4x6
                const file = document.getElementById("foto_4x6").files[0];
                if (!file) return alert("Foto 4x6 wajib diupload.");

                if (
                  !["image/jpeg", "image/jpg", "image/png"].includes(file.type)
                ) {
                  return alert("Format foto harus JPG, JPEG, atau PNG.");
                }

                if (file.size > 1 * 1024 * 1024) {
                  return alert("Ukuran foto maksimal 1 MB.");
                }

                modalKonfirmasi.show();
              });

              function showDuplicateModal(msg) {
                document.getElementById("duplikatMessage").innerText = msg;
                const modal = new bootstrap.Modal(
                  document.getElementById("modalDuplikat"),
                );
                modal.show();
              }

              // ==========================
              // KONFIRMASI SUBMIT
              // ==========================
              document
                .getElementById("btnKonfirmasiSubmit")
                .addEventListener("click", async () => {
                  const formData = new FormData(form);

                  try {
                    const res = await fetch(
                      "http://localhost:5000/api/pendaftaran",
                      {
                        method: "POST",
                        body: formData,
                      },
                    );

                    const data = await res.json();

                    if (!res.ok) {
                      document.getElementById("modalGagalMessage").innerText =
                        data.message;
                      new bootstrap.Modal(
                        document.getElementById("modalGagal"),
                      ).show();
                      return;
                    }

                    new bootstrap.Modal(
                      document.getElementById("modalBerhasil"),
                    ).show();

                    form.reset();
                    modalKonfirmasi.hide();

                    // Reset dynamic fields
                    jabatanContainer.classList.add("d-none");
                    jabatanSelect.removeAttribute("required");
                    jabatanSelect.innerHTML =
                      '<option value="">Pilih Jabatan</option>';

                    pangkatContainer.classList.add("d-none");
                    pangkatSelect.removeAttribute("required");
                  } catch (err) {
                    document.getElementById("modalGagalMessage").innerText =
                      "Terjadi kesalahan jaringan, coba beberapa saat lagi.";
                    new bootstrap.Modal(
                      document.getElementById("modalGagal"),
                    ).show();
                  }
                });

              // =====================================================
              // TRIGGER INITIAL STATE
              // =====================================================
              jenisNakesSelect.dispatchEvent(new Event("change"));
              statusPegawaiSelect.dispatchEvent(new Event("change"));
            });
          </script>
        </div>

        <!-- Modal Konfirmasi -->
        <div class="modal fade" id="modalKonfirmasi" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-warning">
                <h5 class="modal-title">Konfirmasi Pendaftaran</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>

              <div class="modal-body text-center">
                <p style="font-size: 16px; font-weight: 500">
                  Apakah Anda sudah yakin menginputkan data yang benar?
                </p>
              </div>

              <div class="modal-footer d-flex justify-content-between">
                <button class="btn btn-secondary" data-bs-dismiss="modal">
                  Cek Kembali
                </button>

                <button id="btnKonfirmasiSubmit" class="btn btn-primary">
                  Daftar Pelatihan
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Berhasil Daftar -->
        <div class="modal fade" id="modalBerhasil" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Pendaftaran Berhasil</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>

              <div class="modal-body">
                <p>
                  Terima kasih telah mendaftar pelatihan di
                  <b>DIKLAT RSUD Prof. Dr. Margono Soekarjo</b>.
                </p>

                <p>
                  Status pendaftaran Anda saat ini adalah
                  <b>Menunggu Verifikasi Berkas</b>.
                </p>

                <p>
                  Tim kami akan melakukan verifikasi terhadap berkas yang telah
                  Anda unggah. Informasi selanjutnya akan disampaikan melalui
                  <b>Email</b>.
                </p>

                <p>
                  Mohon memastikan email Anda aktif dan rutin memeriksa folder
                  <i>Inbox</i> maupun <i>Spam</i>.
                </p>
              </div>

              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-success"
                  data-bs-dismiss="modal"
                >
                  Oke
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Gagal Daftar -->
        <div class="modal fade" id="modalGagal" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Pendaftaran Gagal</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>

              <div class="modal-body">
                <p id="modalGagalMessage">
                  Terjadi kesalahan, silahkan coba lagi.
                </p>
              </div>

              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-danger"
                  data-bs-dismiss="modal"
                >
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ========================================= -->
        <!-- MODAL DUPLIKAT PENDAFTARAN -->
        <!-- ========================================= -->
        <div
          class="modal fade"
          id="modalDuplikat"
          tabindex="-1"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Data Duplikat</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>

              <div class="modal-body">
                <p id="duplikatMessage" class="mb-0"></p>
              </div>

              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Process Steps -->
        <div class="process-steps mt-5" data-aos="fade-up" data-aos-delay="300">
          <div class="row justify-content-center text-center gy-4">
            <!-- Step 1 -->
            <div class="col-lg-2 col-md-6">
              <div class="step-item">
                <div class="step-number">1</div>
                <div class="step-icon">
                  <i class="bi bi-calendar-date"></i>
                </div>
                <h5>Pilih Menu Pelatihan</h5>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="col-lg-2 col-md-6">
              <div class="step-item">
                <div class="step-number">2</div>
                <div class="step-icon">
                  <i class="bi bi-person-fill"></i>
                </div>
                <h5>Isi Formulir Pendaftaran</h5>
              </div>
            </div>

            <!-- Step 3 -->
            <div class="col-lg-2 col-md-6">
              <div class="step-item">
                <div class="step-number">3</div>
                <div class="step-icon">
                  <i class="bi bi-check-circle"></i>
                </div>
                <h5>Verifikasi Berkas Pendaftaran</h5>
              </div>
            </div>

            <!-- Step 4 -->
            <div class="col-lg-2 col-md-6">
              <div class="step-item">
                <div class="step-number">4</div>
                <div class="step-icon">
                  <i class="bi bi-wallet"></i>
                </div>
                <h5>Upload Bukti Pembayaran</h5>
              </div>
            </div>

            <!-- Step 5 -->
            <div class="col-lg-2 col-md-6">
              <div class="step-item">
                <div class="step-number">5</div>
                <div class="step-icon">
                  <i class="bi bi-calendar-check"></i>
                </div>
                <h5>Mengikuti Pelatihan</h5>
              </div>
            </div>
            <a href="alurpendaftaran.html" class="feature-link mt-2">
              <span>Lihat Detail Alur Pendaftaran Pelatihan</span>
              <i class="bi bi-arrow-right"></i>
            </a>
          </div>
        </div>
      </section>
      <!-- /Appointmnet Section -->
    </main>

    <!-- ======= FOOTER ======= -->
    <footer id="footer" class="footer position-relative light-background">
      <div class="container footer-top">
        <div class="row gy-4">
          <div class="col-lg-4 col-md-6 footer-about">
            <a href="index.html" class="logo d-flex align-items-center">
              <span class="sitename">DIKLAT RSMS</span>
            </a>
            <div class="footer-contact pt-3">
              <p>Jl. Dr. Gumbreg No.1, Kebontebu, Berkoh,</p>
              <p>Kec. Purwokerto Sel., Kabupaten Banyumas,</p>
              <p>Jawa Tengah 53146</p>
              <p class="mt-3">
                <strong>Phone:</strong> <span>(0281) 632704</span>
              </p>
              <p>
                <strong>Email:</strong> <span>rsmargono@jatengprov.go.id</span>
              </p>
            </div>
            <div class="social-links d-flex mt-4">
              <a href="https://x.com/rsudmargono"
                ><i class="bi bi-twitter-x"></i
              ></a>
              <a href="https://www.facebook.com/RSMargono/"
                ><i class="bi bi-facebook"></i
              ></a>
              <a href="https://www.instagram.com/rsudmargono/"
                ><i class="bi bi-instagram"></i
              ></a>
              <a href="https://www.youtube.com/@rsmargono"
                ><i class="bi bi-youtube"></i
              ></a>
            </div>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="contact.html">Kontak</a></li>
              <li><a href="gallery.html">Gallery</a></li>
            </ul>
          </div>

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Pelatihan</h4>
            <ul>
              <li><a href="menupelatihan.html">Menu Pelatihan</a></li>
              <li><a href="daftarpelatihan.html">Daftar Pelatihan</a></li>
              <li><a href="kalender.html">Kalender Pelatihan</a></li>
              <li><a href="alurpendaftaran.html">Alur Pendaftaran</a></li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-3 footer-links">
            <h4>Tim & Mitra Pelatihan</h4>
            <ul>
              <li>
                <a href="fasilitator.html"
                  >Profesional Fasilitor dan Instruktur</a
                >
              </li>
              <li>
                <a href="penyelenggara.html">Tim Penyelenggara Pelatihan</a>
              </li>
              <li><a href="instruktur.html">Institusi Kerjasama</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="container copyright text-center mt-4">
        <p>
          © <span>Copyright</span>
          <strong class="px-1 sitename">RSUD Prof. Dr. Margono Soekarjo</strong>
        </p>
      </div>
    </footer>

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
    >
      <i class="bi bi-arrow-up-short"></i>
    </a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
  </body>
</html>
